<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />
    <title></title>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>

    <!-- /theme JS files -->
    <style type="text/css">
            table#data-wc-table {
            margin:0;
            border:none;
            background-color:#FFF;
            border-collapse:separate;
            border-spacing:0;
            border-left:1px solid #ccc;
        }
        table#data-wc-table th {
            background:#00bcd4;
            color:#FFF;
            padding:4px;
            position:sticky;
            top:0;
            font-weight: bold;
            font-size: 0.82em;
            vertical-align: middle;
            z-index:1;
            font-family: Roboto,Helvetica Neue,Helvetica,Arial,sans-serif;
        }
        table#data-wc-table td {
            background:#fff;
            padding:5px 5px;
            font-size: 0.7em;
            font-weight: bold;
            font-family: Roboto,Helvetica Neue,Helvetica,Arial !important;
        }
        /* ensure first header cell sits atop everything else when scrolling right */
        table#data-wc-table th:first-child {
            position:sticky;
            left:0;
            z-index:2;
        }
        /* make first column sticky when scrolling right */
        table#data-wc-table td:first-child {
            position:sticky;
            left:0;
            border-right-color:#aaa;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="page-container">
        <br/>
        <div class="col-md-12" style="font-family: Roboto,Helvetica Neue,Helvetica,Arial !important; font-weight: bold;">
            <h4>SI SÔI ĐỘNG CÙNG WORLD CUP 2022 - BẢNG XẾP HẠNG CÁC TAY ĐUA WORLD CUP 2022</h4>
        </div>
        <div class="col-md-12" style="font-family: Roboto,Helvetica Neue,Helvetica,Arial !important;"">
            <div role="alert"><b>Tổng số điểm: <span class="alert-warning" id="spnTotalMoney"></span><b></div>
                    <br/>
        </div>
        <div class="col-md-12">
            <table class="table table-striped" id="data-wc-table">
              <thead class="bg-info text-center" id="wc-headers">
                <tr>
                    <th style="min-width: 150px">Họ và tên</th>
                    <th class="text-center header" style="min-width: 100px">Xếp hạng</th>
                    <th class="text-center header">Tổng điểm</th>
                    <th class="text-center header " style="min-width: 100px" id="scheduler-1"> Trận 1</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-2"> Trận 2</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-3"> Trận 3</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-4"> Trận 4</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-5"> Trận 5</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-6"> Trận 6</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-7"> Trận 7</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-8"> Trận 8</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-9"> Trận 9</th>
                    <th class="text-center header header" style="min-width: 100px" id="scheduler-10"> Trận 10</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-11"> Trận 11</th>
                    <th class="text-center header header" style="min-width: 100px" id="scheduler-12"> Trận 12</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-13"> Trận 13</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-14"> Trận 14</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-15"> Trận 15</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-16"> Trận 16</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-17"> Trận 17</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-18"> Trận 18</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-19"> Trận 19</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-20"> Trận 20</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-21"> Trận 21</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-22"> Trận 22</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-23"> Trận 23</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-24"> Trận 24</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-25"> Trận 25</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-26"> Trận 26</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-27"> Trận 27</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-28"> Trận 28</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-29"> Trận 29</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-30"> Trận 30</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-31"> Trận 31</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-32"> Trận 32</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-33"> Trận 33</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-34"> Trận 34</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-35"> Trận 35</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-36"> Trận 36</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-37"> Trận 37</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-38"> Trận 38</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-39"> Trận 39</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-40"> Trận 40</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-41"> Trận 41</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-42"> Trận 42</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-43"> Trận 43</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-44"> Trận 44</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-45"> Trận 45</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-46"> Trận 46</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-47"> Trận 47</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-48"> Trận 48</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-49"> Trận 49</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-50"> Trận 50</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-51"> Trận 51</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-52"> Trận 52</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-53"> Trận 53</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-54"> Trận 54</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-55"> Trận 55</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-56"> Trận 56</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-57"> Trận 57</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-58"> Trận 58</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-59"> Trận 59</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-60"> Trận 60</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-61"> Trận 61</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-62"> Trận 62</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-63"> Trận 63</th>
                    <th class="text-center header" style="min-width: 100px" id="scheduler-64"> Trận 64</th>
                </tr>
              </thead>
              <tbody id="wc-data">
              </tbody>
            </table>
        </div>
    </div>
        <!-- /page container -->
        <script type="text/javascript">
            var get_data_endpoint = "https://gw-bioid.vnpt.vn/wc/1.0/WorldCup/GetData_Guess";
            var response_data;
            $( document ).ready(function() {
                $.ajax({
                  type: 'GET',
                  async: false,
                  url: get_data_endpoint,
                  data: "",
                  success: function(output) {response_data = output.data}
                });

                if (response_data){
                    var content = "";
                    var data_map = {};
                    var point_array = [];
                    var point_map = {};
                    var guess_map = {};
                    var schedulers = [];
                    var scheduler_names = [];

                    $.each(response_data, function (i, item) {
                        schedulers.push(item.scheduler_id);
                        scheduler_names.push(item.a_team + ' - '+ item.b_team);
                        $('#scheduler-' + (i+1)).html((item.a_team + ' - '+ item.b_team) + '<br/>(' + item.a_final_result + "-" + item.b_final_result + ')')
                        if ((new Date().getTime() - new Date(item.date).getTime()) < 0){
                             return;
                         }

                        $.each(item.guess_data, function (i, item1) {
                            point_array = data_map[item1.tele_id];
                            if (!point_array){
                                data_map[item1.tele_id] = {"name": item1.name, "points": [], "total": 0, "guess": [], "point_map": {}, "guess_map": {}};
                            }

                            var total = data_map[item1.tele_id].total || 0;
                            point_array = data_map[item1.tele_id].points;

                            point_map = data_map[item1.tele_id].point_map;
                            guess_map = data_map[item1.tele_id].guess_map;

                            point_map[item.scheduler_id] = item1.final_point;
                            guess_map[item.scheduler_id] = (item1.description == "-1" ) ? "-" : (item1.a_guess_result + "-" + item1.b_guess_result);

                            point_array.push(item1.final_point);
                            total+= item1.final_point;

                            var guess = data_map[item1.tele_id].guess;
                            if (!guess){
                                guess = [];
                            }

                            guess.push(item1.a_guess_result + "-" + item1.b_guess_result);

                            var person_data = {"name": item1.name, "points": point_array, "total": total, "guess": guess, "point_map": point_map, "guess_map": guess_map};
                            data_map[item1.tele_id] = person_data;
                        });
                        
                    });


                    var result = [];
                    for(var i in data_map)
                        result.push([i, data_map[i]]);

                    result.sort(function(a, b) {
                      return (a[1].total < b[1].total) ? -1 : 1;
                    });

                    console.log(result);

                    var total_point = 0;
                    $.each(result, function (i, item) {
                        total_point+= (item[1].total);
                        content += '<tr><td>'+ item[1].name +'</td>';
                        content += '<td class="text-center">'+ (i == 0 ? '<span class="alert-warning">Ví vàng</span>' : (i + 1)) +'</td>';
                        content += '<td class="text-center"><span class="'+ (item[1].total > 0 ? 'alert-success': (item[1].total ? 'alert-danger' : 'alert-warning') ) +'">'+(item[1].total ? (item[1].total > 0 ? '+' + item[1].total : item[1].total) : '-')+'</span></td>';
                        // content += '<td class="text-center"><span class="'+ (item[1].total > 0 ? 'alert-success': (item[1].total ? 'alert-danger' : 'alert-warning') ) +'">'+(item[1].total ? (item[1].total > 0 ? '+' + (item[1].total*1000).toLocaleString('it-IT', {style : 'currency', currency : 'VND'}) : (item[1].total*1000).toLocaleString('it-IT', {style : 'currency', currency : 'VND'})) : '-')+'</span></td>';

                        $.each(schedulers, function (i, scheduler) {
                            content += '<td class="text-center"><span class="'+ (item[1].point_map[scheduler] > 0 ? 'alert-success': (item[1].point_map[scheduler] ? 'alert-danger' : 'alert-warning') ) +'">'+(item[1].point_map[scheduler] ? (item[1].point_map[scheduler] > 0 ? '+' + item[1].point_map[scheduler] : item[1].point_map[scheduler]) : '-') +'</span><br/><span>('+ (item[1].guess_map[scheduler] ? item[1].guess_map[scheduler] : '-') +')</span></td>';
                        });
                         content +='</tr>';
                    });

                    console.log(total_point);
                    $("#wc-data").html(content);
                    $("#spnTotalMoney").html(total_point);
                    document.getElementById("scheduler-" + ((schedulers.length + 12) < 64 ? schedulers.length + 12 : 64)).scrollIntoView();
                }
        });

        function get_awards(i){
            if (i == 0){
                return '<span class="alert-warning">Tiên tri</span>';
            }
        }
        </script>
        <!-- Footer -->
        <div class="footer text-muted"> © 2022. VNPTIT - SI </div>
        <!-- /footer -->
</body>

</html>
